# GitHub Issues Collection Plan

## Extract repo lists for the following

### Input Format 1 - Direct URL
```
https://github.com/stripe/stripe-node
```

### Input Format 2 - CSV Data
```
shopify,cli,92,543,197,2025-08-12,0,"Build apps, themes, and hydrogen storefronts for Shopify",75,https://github.com/shopify/cli
stripe,stripe-mock,4,1495,120,2025-08-11,0,stripe-mock is a mock HTTP server that responds like the real Stripe API. It can be used instead of Stripe's testmode to make test suites integrating with Stripe faster and less brittle.,64,https://github.com/stripe/stripe-mock
shopify,checkout-sheet-kit-swift,14,52,23,2025-08-12,0,Shopify's Checkout Sheet Kit makes it simple to perform a checkout inside your Swift native app.,44,https://github.com/shopify/checkout-sheet-kit-swift
stripe,stripe-react-native,161,1353,291,2025-08-11,24,React Native library for Stripe.,34,https://github.com/stripe/stripe-react-native
shopify,react-native-skia,88,7748,527,2025-08-12,20,High-performance React Native Graphics using Skia,22,https://github.com/shopify/react-native-skia
shopify,hydrogen,164,1715,352,2025-08-11,0,"Hydrogen lets you build faster headless storefronts in less time, on Shopify.",19,https://github.com/shopify/hydrogen
shopify,dev-mcp,28,464,52,2025-08-12,17,Shopify.dev MCP server,19,https://github.com/shopify/dev-mcp
stripe,stripe-terminal-react-native,31,138,58,2025-08-12,6,React Native SDK for Stripe Terminal,18,https://github.com/stripe/stripe-terminal-react-native
shopify,roast,168,799,38,2025-08-11,12,Structured AI workflows made easy,12,https://github.com/shopify/roast
shopify,tapioca,115,794,149,2025-08-12,0,The swiss army knife of RBI generation,12,https://github.com/shopify/tapioca
shopify,theme-tools,133,145,52,2025-08-05,0,Everything developer experience for Shopify themes,11,https://github.com/shopify/theme-tools
shopify,yjit-metrics,14,16,11,2025-08-04,0,"""Tasks for benchmarking, building and collecting stats for YJIT""",11,https://github.com/shopify/yjit-metrics
stripe,stripe-js,12,700,172,2025-08-01,2,Loading wrapper for Stripe.js,11,https://github.com/stripe/stripe-js
shopify,shopify-app-js,111,435,166,2025-08-11,0,,10,https://github.com/shopify/shopify-app-js
stripe,pg-schema-diff,55,558,39,2025-08-11,0,Go library for diffing Postgres schemas and generating SQL migrations,10,https://github.com/stripe/pg-schema-diff
shopify,job-iteration,49,1245,53,2025-08-11,20,Makes your background jobs interruptible and resumable by design.,9,https://github.com/shopify/job-iteration
stripe,stripe-node,49,4152,805,2025-08-11,10,Node.js library for the Stripe API.    ,8,https://github.com/stripe/stripe-node
stripe,stripe-dotnet,19,1432,578,2025-08-11,4,"Stripe.net is a sync/async .NET 4.6.1+ client, and a portable class library for stripe.com.",8,https://github.com/stripe/stripe-dotnet
shopify,flash-list,214,6497,322,2025-08-11,33,A better list for React Native,7,https://github.com/shopify/flash-list
shopify,toxiproxy,92,11412,471,2025-08-11,-1,:alarm_clock: :fire: A TCP proxy to simulate network and system conditions for chaos and resiliency testing,7,https://github.com/shopify/toxiproxy
stripe,stripe-go,13,2372,487,2025-08-11,2,Go library for the Stripe API.    ,7,https://github.com/stripe/stripe-go
shopify,semian,51,1423,81,2025-08-12,-1,:monkey: Resiliency toolkit for Ruby for failing fast,6,https://github.com/shopify/semian
stripe,stripe-ruby,19,2037,578,2025-08-11,3,Ruby library for the Stripe API.    ,6,https://github.com/stripe/stripe-ruby
shopify,cli-ui,14,1090,57,2025-08-04,-1,CLI tooling framework with simple interactive widgets,5,https://github.com/shopify/cli-ui
```

## Available Methods (Existing Scripts)

### Core Classes
- **GitHubClient** (`scripts/github_client/client.py`)
  - `get_repo_stats(owner, repo)` - Fetch repository statistics
  - `get_issues(owner, repo, max_issues)` - Fetch repository issues
  - `_get_contributors_count(owner, repo)` - Get contributor count with pagination
  - `_get_open_prs_count(owner, repo)` - Get open PR count

- **IssueCollector** (`scripts/github_client/issue_collector.py`)
  - `collect_repository_issues(owner, repo, max_issues)` - Collect issues for single repo
  - `save_issues_to_markdown(owner, repo, issues)` - Save to markdown format
  - `collect_from_list(repositories)` - Batch collection from repo list

### Data Models (`scripts/github_client/models.py`)
- **IssueData** - Issue data model with fields:
  - number, title, state, labels, comments
  - created_at, updated_at, body, author
  - `to_markdown_entry()` method

## New Scripts to Create

### 1. `scripts/collect_issues_to_csv.py`
Main script to collect issues and save to CSV format with:
- Parse repository list from prompt file
- Use existing GitHubClient to fetch issues
- Save to CSV with required format
- Include metadata header (total issues, repository URL)

### 2. Enhancement to `models.py`
Add new method to IssueData class:
```python
def to_csv_row(self) -> List[str]:
    """Convert issue to CSV row format."""
    # Returns: [title, comments_count, labels, opened_date, hyperlink]
```

## Execution Sequence

1. **Parse Repository Lists**
   - Read prompt file to extract repositories
   - Parse both URL format and CSV format
   - Create list of (owner, repo) tuples

2. **Initialize Collection**
   ```python
   from github_client.issue_collector import IssueCollector
   collector = IssueCollector(github_token)
   ```

3. **Spot Check Test (Single Repository)**
   ```python
   # Test with stripe/stripe-go
   issues = collector.collect_repository_issues("stripe", "stripe-go", max_issues=100)
   save_to_csv("stripe", "stripe-go", issues)
   # Verify output at data/repos/stripe_stripe-go.csv
   ```

4. **Batch Collection**
   ```python
   for owner, repo in repository_list:
       issues = collector.collect_repository_issues(owner, repo)
       save_to_csv(owner, repo, issues)
       time.sleep(1)  # Rate limiting
   ```

5. **Progress Monitoring**
   - Display progress: "Processing 5/24: shopify/cli..."
   - Show issues found per repository
   - Track total collection time

## Output Structure

```
data/
  repos/
    stripe_stripe-go.csv
    stripe_stripe-node.csv
    stripe_stripe-mock.csv
    shopify_cli.csv
    shopify_cli-ui.csv
    shopify_hydrogen.csv
    ... (one file per repository)
```

## Output Detail Format

Each CSV file will have:

### Metadata Header (as comments)
```
# Issues Total: 75
# Repository: https://github.com/shopify/cli-ui
# Generated: 2025-08-12
```

### CSV Table Structure
```csv
issue_title,comments_count,labels,opened_date,hyperlink
"Bug: CLI crashes on startup",5,"bug,priority-high",2025-08-01,https://github.com/shopify/cli-ui/issues/123
"Feature: Add dark mode",12,"enhancement",2025-07-15,https://github.com/shopify/cli-ui/issues/122
```

### Important Notes:
- DO NOT INCLUDE ISSUE DESCRIPTION in CSV
- Labels are comma-separated within quotes if multiple
- Date format: YYYY-MM-DD
- Use proper CSV escaping for titles with commas/quotes
- Include ALL issues (both open and closed)
- Sort by most recently updated first